<!DOCTYPE html>
<html lang="en"><head><script src="/facturotas.docs/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=facturotas.docs/livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon shortcut" href="/facturotas.docs/favicon.ico" sizes="32x32" />
<link rel="icon" href="/facturotas.docs/favicon.svg" type="image/svg+xml" />
<link rel="icon" href="/facturotas.docs/favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)" />
<link rel="icon" href="/facturotas.docs/favicon-16x16.png" type="image/png" sizes="16x16" />
<link rel="icon" href="/facturotas.docs/favicon-32x32.png" type="image/png" sizes="32x32" />
<link rel="apple-touch-icon" href="/facturotas.docs/apple-touch-icon.png" sizes="180x180" />
<link fetchpriority="low" href="/facturotas.docs/site.webmanifest" rel="manifest" />
<title>Facturotas</title>
  <meta name="description" content="Endpoints TimbradoEsta sección detalla la operación del servicio de timbrado, permitiendo procesar y obtener el XML timbrado de un Comprobante Fiscal Digital (CFDI).
timbrar Descripción de la Operación Esta operación permite timbrar un (Comprobante Fiscal Digital por Internet) CFDI en sus versiones 3.3 o 4.0 y retornar el XML timbrado completo del comprobante fiscal junto con su folio fiscal UUID y sello digital por el SAT." /><link rel="canonical" href="http://localhost:1313/facturotas.docs/api/endpoints_timbrado/" itemprop="url" />

<meta property="og:title" content="" />
<meta property="og:description" content="Endpoints TimbradoEsta sección detalla la operación del servicio de timbrado, permitiendo procesar y obtener el XML timbrado de un Comprobante Fiscal Digital (CFDI).
timbrar
    Descripción de la Operación
    Esta operación permite timbrar un (Comprobante Fiscal Digital por Internet) CFDI en sus versiones 3.3 o 4.0 y retornar el XML timbrado completo del comprobante fiscal junto con su folio fiscal UUID y sello digital por el SAT." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/facturotas.docs/api/endpoints_timbrado/" /><meta property="article:section" content="api" />



  <meta itemprop="name" content="Facturotas">
  <meta itemprop="description" content="Endpoints TimbradoEsta sección detalla la operación del servicio de timbrado, permitiendo procesar y obtener el XML timbrado de un Comprobante Fiscal Digital (CFDI).
timbrar Descripción de la Operación Esta operación permite timbrar un (Comprobante Fiscal Digital por Internet) CFDI en sus versiones 3.3 o 4.0 y retornar el XML timbrado completo del comprobante fiscal junto con su folio fiscal UUID y sello digital por el SAT.">
  <meta itemprop="wordCount" content="2275">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Facturotas">
  <meta name="twitter:description" content="Endpoints TimbradoEsta sección detalla la operación del servicio de timbrado, permitiendo procesar y obtener el XML timbrado de un Comprobante Fiscal Digital (CFDI).
timbrar Descripción de la Operación Esta operación permite timbrar un (Comprobante Fiscal Digital por Internet) CFDI en sus versiones 3.3 o 4.0 y retornar el XML timbrado completo del comprobante fiscal junto con su folio fiscal UUID y sello digital por el SAT.">

    <link href="/facturotas.docs/css/compiled/main.css" rel="stylesheet" />



  <link href="/facturotas.docs/css/custom.css" rel="stylesheet" />


  <script>
     
    const defaultTheme = 'system';

    const setDarkTheme = () => {
      document.documentElement.classList.add("dark");
      document.documentElement.style.colorScheme = "dark";
    }
    const setLightTheme = () => {
      document.documentElement.classList.remove("dark");
      document.documentElement.style.colorScheme = "light";
    }

    if ("color-theme" in localStorage) {
      localStorage.getItem("color-theme") === "dark" ? setDarkTheme() : setLightTheme();
    } else {
      defaultTheme === "dark" ? setDarkTheme() : setLightTheme();
      if (defaultTheme === "system") {
        window.matchMedia("(prefers-color-scheme: dark)").matches ? setDarkTheme() : setLightTheme();
      }
    }
  </script>

  
</head>
<body dir="ltr"><div class="nav-container hx-sticky hx-top-0 hx-z-20 hx-w-full hx-bg-transparent print:hx-hidden">
  <div class="nav-container-blur hx-pointer-events-none hx-absolute hx-z-[-1] hx-h-full hx-w-full hx-bg-white dark:hx-bg-dark hx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] contrast-more:hx-shadow-[0_0_0_1px_#000] dark:hx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:dark:hx-shadow-[0_0_0_1px_#fff]"></div>

  <nav class="hx-mx-auto hx-flex hx-items-center hx-justify-end hx-gap-2 hx-h-16 hx-px-6 hx-max-w-[90rem]">
    <a class="hx-flex hx-items-center hover:hx-opacity-75 ltr:hx-mr-auto rtl:hx-ml-auto" href="/facturotas.docs/">
        <img class="hx-mr-2 hx-block dark:hx-hidden" src="/facturotas.docs/images/logo.svg" alt="Facturotas" height="20" width="20" />
        <img class="hx-mr-2 hx-hidden dark:hx-block" src="/facturotas.docs/images/logo.svg" alt="Facturotas" height="20" width="20" />
        <span class="hx-mr-2 hx-font-extrabold hx-inline hx-select-none" title="Facturotas">Facturotas</span>
    </a><button type="button" aria-label="Menu" class="hamburger-menu -hx-mr-2 hx-rounded hx-p-2 active:hx-bg-gray-400/20 md:hx-hidden"><svg height=24 fill="none" viewBox="0 0 24 24" stroke="currentColor"><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8H20"></path></g><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16H20"></path></g></svg></button>
  </nav>
</div>

  <div class='hx-mx-auto hx-flex hx-max-w-screen-xl'>
    <div class="mobile-menu-overlay [transition:background-color_1.5s_ease] hx-fixed hx-inset-0 hx-z-10 hx-bg-black/80 dark:hx-bg-black/60 hx-hidden"></div>
<aside class="sidebar-container hx-flex hx-flex-col print:hx-hidden md:hx-top-16 md:hx-shrink-0 md:hx-w-64 md:hx-self-start max-md:[transform:translate3d(0,-100%,0)] md:hx-sticky">
  
  <div class="hx-px-4 hx-pt-4 md:hx-hidden">
    <div class="search-wrapper hx-relative md:hx-w-64">
  <div class="hx-relative hx-flex hx-items-center hx-text-gray-900 contrast-more:hx-text-gray-800 dark:hx-text-gray-300 contrast-more:dark:hx-text-gray-300">
    <input
      placeholder="Search..."
      class="search-input hx-block hx-w-full hx-appearance-none hx-rounded-lg hx-px-3 hx-py-2 hx-transition-colors hx-text-base hx-leading-tight md:hx-text-sm hx-bg-black/[.05] dark:hx-bg-gray-50/10 focus:hx-bg-white dark:focus:hx-bg-dark placeholder:hx-text-gray-500 dark:placeholder:hx-text-gray-400 contrast-more:hx-border contrast-more:hx-border-current"
      type="search"
      value=""
      spellcheck="false"
    />
    <kbd
      class="hx-absolute hx-my-1.5 hx-select-none ltr:hx-right-1.5 rtl:hx-left-1.5 hx-h-5 hx-rounded hx-bg-white hx-px-1.5 hx-font-mono hx-text-[10px] hx-font-medium hx-text-gray-500 hx-border dark:hx-border-gray-100/20 dark:hx-bg-dark/50 contrast-more:hx-border-current contrast-more:hx-text-current contrast-more:dark:hx-border-current hx-items-center hx-gap-1 hx-transition-opacity hx-pointer-events-none hx-hidden sm:hx-flex"
    >
      CTRL K
    </kbd>
  </div>

  <div>
    <ul
      class="search-results hextra-scrollbar hx-hidden hx-border hx-border-gray-200 hx-bg-white hx-text-gray-100 dark:hx-border-neutral-800 dark:hx-bg-neutral-900 hx-absolute hx-top-full hx-z-20 hx-mt-2 hx-overflow-auto hx-overscroll-contain hx-rounded-xl hx-py-2.5 hx-shadow-xl hx-max-h-[min(calc(50vh-11rem-env(safe-area-inset-bottom)),400px)] md:hx-max-h-[min(calc(100vh-5rem-env(safe-area-inset-bottom)),400px)] hx-inset-x-0 ltr:md:hx-left-auto rtl:md:hx-right-auto contrast-more:hx-border contrast-more:hx-border-gray-900 contrast-more:dark:hx-border-gray-50 hx-w-screen hx-min-h-[100px] hx-max-w-[min(calc(100vw-2rem),calc(100%+20rem))]"
      style="transition: max-height 0.2s ease 0s;"
    ></ul>
  </div>
</div>

  </div>
  <div class="hextra-scrollbar hx-overflow-y-auto hx-overflow-x-hidden hx-p-4 hx-grow md:hx-h-[calc(100vh-var(--navbar-height)-var(--menu-height))]">
    <ul class="hx-flex hx-flex-col hx-gap-1 md:hx-hidden">
      
      
          <li class=""><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/guias/"
    
  >Guias
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/guias/authentication/"
    
  >Authentication
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/guias/getting-started/"
    
  >Getting Started
    </a>
              
            </li></ul>
      </div></li>
          <li class="open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/api/"
    
  >API
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      sidebar-active-item hx-bg-primary-100 hx-font-semibold hx-text-primary-800 contrast-more:hx-border contrast-more:hx-border-primary-500 dark:hx-bg-primary-400/10 dark:hx-text-primary-600 contrast-more:dark:hx-border-primary-500"
    href="/facturotas.docs/api/endpoints_timbrado/"
    
  >Endpoints Timbrado
    </a>
  
    <ul class='hx-flex hx-flex-col hx-gap-1 hx-relative before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] dark:before:hx-bg-neutral-800 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-pr-3 rtl:before:hx-right-0 ltr:hx-ml-3 rtl:hx-mr-3'><li>
              <a
                href="#timbrar"
                class="hx-flex hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [word-break:break-word] hx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:hx-border hx-gap-2 before:hx-opacity-25 before:hx-content-['#'] hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:hx-text-gray-900 contrast-more:dark:hx-text-gray-50 contrast-more:hx-border-transparent contrast-more:hover:hx-border-gray-900 contrast-more:dark:hover:hx-border-gray-50"
              >timbrar</a>
            </li>
          </ul>
  
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/api/schemas/"
    
  >Schemas
    </a>
              
            </li></ul>
      </div></li>
    </ul>

    <ul class="hx-flex hx-flex-col hx-gap-1 max-md:hx-hidden">
        
          <li class=""><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/guias/"
    
  >Guias
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/guias/authentication/"
    
  >Authentication
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/guias/getting-started/"
    
  >Getting Started
    </a>
              
            </li></ul>
      </div></li>
          <li class="open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/api/"
    
  >API
        <span class="hextra-sidebar-collapsible-button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="hx-h-[18px] hx-min-w-[18px] hx-rounded-sm hx-p-0.5 hover:hx-bg-gray-800/5 dark:hover:hx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="hx-origin-center hx-transition-transform rtl:-hx-rotate-180"></path></svg></span>
    </a><div class="ltr:hx-pr-0 hx-overflow-hidden">
        <ul class='hx-relative hx-flex hx-flex-col hx-gap-1 before:hx-absolute before:hx-inset-y-1 before:hx-w-px before:hx-bg-gray-200 before:hx-content-[""] ltr:hx-ml-3 ltr:hx-pl-3 ltr:before:hx-left-0 rtl:hx-mr-3 rtl:hx-pr-3 rtl:before:hx-right-0 dark:before:hx-bg-neutral-800'><li class="hx-flex hx-flex-col open"><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      sidebar-active-item hx-bg-primary-100 hx-font-semibold hx-text-primary-800 contrast-more:hx-border contrast-more:hx-border-primary-500 dark:hx-bg-primary-400/10 dark:hx-text-primary-600 contrast-more:dark:hx-border-primary-500"
    href="/facturotas.docs/api/endpoints_timbrado/"
    
  >Endpoints Timbrado
    </a>
              
            </li><li class="hx-flex hx-flex-col "><a
    class="hx-flex hx-items-center hx-justify-between hx-gap-2 hx-cursor-pointer hx-rounded hx-px-2 hx-py-1.5 hx-text-sm hx-transition-colors [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] [word-break:break-word]
      hx-text-gray-500 hover:hx-bg-gray-100 hover:hx-text-gray-900 contrast-more:hx-border contrast-more:hx-border-transparent contrast-more:hx-text-gray-900 contrast-more:hover:hx-border-gray-900 dark:hx-text-neutral-400 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50 contrast-more:dark:hx-text-gray-50 contrast-more:dark:hover:hx-border-gray-50"
    href="/facturotas.docs/api/schemas/"
    
  >Schemas
    </a>
              
            </li></ul>
      </div></li>
        
      </ul>
    </div>
  
  
    <div class="  hx-sticky hx-bottom-0 hx-bg-white dark:hx-bg-dark hx-mx-4 hx-py-4 hx-shadow-[0_-12px_16px_#fff] hx-flex hx-items-center hx-gap-2 dark:hx-border-neutral-800 dark:hx-shadow-[0_-12px_16px_#111] contrast-more:hx-border-neutral-400 contrast-more:hx-shadow-none contrast-more:dark:hx-shadow-none hx-border-t" data-toggle-animation="show"><div class="hx-flex hx-grow hx-flex-col"><button
  title="Change theme"
  data-theme="light"
  class="theme-toggle hx-group hx-h-7 hx-rounded-md hx-px-2 hx-text-left hx-text-xs hx-font-medium hx-text-gray-600 hx-transition-colors dark:hx-text-gray-400 hover:hx-bg-gray-100 hover:hx-text-gray-900 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50"
  type="button"
  aria-label="Change theme"
>
  <div class="hx-flex hx-items-center hx-gap-2 hx-capitalize"><svg height=12 class="group-data-[theme=light]:hx-hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span class="group-data-[theme=light]:hx-hidden">Light</span><svg height=12 class="group-data-[theme=dark]:hx-hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg><span class="group-data-[theme=dark]:hx-hidden">Dark</span></div>
</button>
</div></div></aside>
    
<nav class="hextra-toc hx-order-last hx-hidden hx-w-64 hx-shrink-0 xl:hx-block print:hx-hidden hx-px-4" aria-label="table of contents">
    <div class="hextra-scrollbar hx-sticky hx-top-16 hx-overflow-y-auto hx-pr-4 hx-pt-6 hx-text-sm [hyphens:auto] hx-max-h-[calc(100vh-var(--navbar-height)-env(safe-area-inset-bottom))] ltr:hx--mr-4 rtl:hx--ml-4"><p class="hx-mb-4 hx-font-semibold hx-tracking-tight">On this page</p><ul>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="hx-font-semibold hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#timbrar">timbrar
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#descripci%c3%b3n-de-la-operaci%c3%b3n">Descripción de la Operación
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#par%c3%a1metros-de-entrada-input">Parámetros de Entrada (Input)
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#par%c3%a1metros-de-salida-output---respuestatimbrado">Parámetros de Salida (Output) - RespuestaTimbrado
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#ejemplo-de-c%c3%b3digo">Ejemplo de Código
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-8 rtl:hx-pr-8 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#solicitud-request">Solicitud (Request)
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-8 rtl:hx-pr-8 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#respuesta-response">Respuesta (Response)
        </a>
      </li></ul>
      <div class="hx-mt-8 hx-border-t hx-bg-white hx-pt-8 hx-shadow-[0_-12px_16px_white] dark:hx-bg-dark dark:hx-shadow-[0_-12px_16px_#111] hx-sticky hx-bottom-0 hx-flex hx-flex-col hx-items-start hx-gap-2 hx-pb-8 dark:hx-border-neutral-800 contrast-more:hx-border-t contrast-more:hx-border-neutral-400 contrast-more:hx-shadow-none contrast-more:dark:hx-border-neutral-400">
        <button aria-hidden="true" id="backToTop" onClick="scrollUp();" class="hx-transition-all hx-duration-75 hx-opacity-0 hx-text-xs hx-font-medium hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-100 contrast-more:hx-text-gray-800 contrast-more:dark:hx-text-gray-50">
          <span>Scroll to top</span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="hx-inline ltr:hx-ml-1 rtl:hx-mr-1 hx-h-3.5 hx-w-3.5 hx-border hx-rounded-full hx-border-gray-500 hover:hx-border-gray-900 dark:hx-border-gray-400 dark:hover:hx-border-gray-100 contrast-more:hx-border-gray-800 contrast-more:dark:hx-border-gray-50">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
          </svg>
        </button>
      </div>
    </div>
  </nav>


    <article class="hx-w-full hx-break-words hx-flex hx-min-h-[calc(100vh-var(--navbar-height))] hx-min-w-0 hx-justify-center hx-pb-8 hx-pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx-w-full hx-min-w-0 hx-max-w-6xl hx-px-6 hx-pt-4 md:hx-px-12">
        
  <div class="hx-mt-1.5 hx-flex hx-items-center hx-gap-1 hx-overflow-hidden hx-text-sm hx-text-gray-500 dark:hx-text-gray-400 contrast-more:hx-text-current">
        <div class="hx-whitespace-nowrap hx-transition-colors hx-min-w-[24px] hx-overflow-hidden hx-text-ellipsis hover:hx-text-gray-900 dark:hover:hx-text-gray-100">
          <a href="/facturotas.docs/api/">API</a>
        </div><svg class="hx-w-3.5 hx-shrink-0 rtl:-hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg><div class="hx-whitespace-nowrap hx-transition-colors hx-font-medium hx-text-gray-700 contrast-more:hx-font-bold contrast-more:hx-text-current dark:hx-text-gray-100 contrast-more:dark:hx-text-current">Endpoints Timbrado</div>
  </div>

        <div class="content">
          
          <h1>Endpoints Timbrado</h1><p>Esta sección detalla la operación del servicio de timbrado, permitiendo procesar y obtener el XML timbrado de un Comprobante Fiscal Digital (CFDI).</p>
<h2>timbrar<span class="hx-absolute -hx-mt-20" id="timbrar"></span>
    <a href="#timbrar" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><h3>Descripción de la Operación<span class="hx-absolute -hx-mt-20" id="descripción-de-la-operación"></span>
    <a href="#descripci%c3%b3n-de-la-operaci%c3%b3n" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>Esta operación permite timbrar un (Comprobante Fiscal Digital por Internet) CFDI en sus versiones 3.3 o 4.0 y retornar el XML timbrado completo del comprobante fiscal junto con su folio fiscal UUID y sello digital por el SAT.</p>
<h3>Parámetros de Entrada (Input)<span class="hx-absolute -hx-mt-20" id="parámetros-de-entrada-input"></span>
    <a href="#par%c3%a1metros-de-entrada-input" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><table>
  <thead>
      <tr>
          <th style="text-align: left">Parámetro</th>
          <th style="text-align: left">Tipo de Dato</th>
          <th style="text-align: left">Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>apikey</code></td>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left">Credencial de acceso al servicio (<a href="../../#Requisitos" >Solicita aquí</a>).</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>xmlCFDI</code></td>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left">Contenido del documento XML del CFDI v3.3 o v4.0.</td>
      </tr>
  </tbody>
</table>
<h3>Parámetros de Salida (Output) - RespuestaTimbrado<span class="hx-absolute -hx-mt-20" id="parámetros-de-salida-output---respuestatimbrado"></span>
    <a href="#par%c3%a1metros-de-salida-output---respuestatimbrado" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><table>
  <thead>
      <tr>
          <th style="text-align: left">Atributo</th>
          <th style="text-align: left">Tipo de Dato</th>
          <th style="text-align: left">Descripción</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>code</code></td>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left">Código de respuesta de la operación.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>message</code></td>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left">Mensaje detallado de la respuesta.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>data</code></td>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left">XML del CFDI timbrado en caso de éxito.</td>
      </tr>
  </tbody>
</table>
<h3>Ejemplo de Código<span class="hx-absolute -hx-mt-20" id="ejemplo-de-código"></span>
    <a href="#ejemplo-de-c%c3%b3digo" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>A continuación se presenta un ejemplo de cómo construir la solicitud y procesar la respuesta utilizando el servicio Web.</p>
<h4>Solicitud (Request)<span class="hx-absolute -hx-mt-20" id="solicitud-request"></span>
    <a href="#solicitud-request" class="subheading-anchor" aria-label="Permalink for this section"></a></h4><div class="hextra-scrollbar hx-overflow-x-auto hx-overflow-y-hidden hx-overscroll-x-contain">
  <div class="hx-mt-4 hx-flex hx-w-max hx-min-w-full hx-border-b hx-border-gray-200 hx-pb-px dark:hx-border-neutral-800"><button
        class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
        role="tab"
        type="button"
        aria-controls="tabs-panel-0" aria-selected="true"  tabindex="0"  data-state="selected">C#</button><button
        class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
        role="tab"
        type="button"
        aria-controls="tabs-panel-1">Java</button><button
        class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
        role="tab"
        type="button"
        aria-controls="tabs-panel-2">Python</button><button
        class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
        role="tab"
        type="button"
        aria-controls="tabs-panel-3">PHP</button></div>
</div>
<div>

  <div
  class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
  id="tabs-panel-0"
  role="tabpanel" tabindex="0"  data-state="selected" ><h3>Herramienta svcutil<span class="hx-absolute -hx-mt-20" id="herramienta-svcutil"></span>
    <a href="#herramienta-svcutil" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>Descarga e instala la herramienta <a href="https://learn.microsoft.com/en-us/dotnet/core/additional-tools/dotnet-svcutil-guide?tabs=dotnetsvcutil2x" target="_blank" rel="noopener">svcutil</a></p>
<p>Ejecuta el comando siguiente (<strong>DESARROLLO</strong>)</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>svcutil.exe https://dev.facturaloplus.com/ws/servicio.do?wsdl /out:ServicioTimbradoClient.cs /config:app.config</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>Esto genera dos archivos: ServicioTimbradoClient.cs y la configuración en app.config</p>
<h3>Implementación<span class="hx-absolute -hx-mt-20" id="implementación"></span>
    <a href="#implementaci%c3%b3n" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span> <span style="color:#75715e">/// Agregar los parámetros necesarios</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// Genera un XML de ejemplo para un CFDI 4.0.</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// En una aplicación real, este XML se construiría dinámicamente.</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;returns&gt;Un string con el contenido del CFDI.&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> TimbrarCfdi() =&gt; <span style="color:#e6db74">&#34;&#34;&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span>      &lt;?xml version=<span style="color:#e6db74">&#34;1.0&#34;</span> encoding=<span style="color:#e6db74">&#34;UTF-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>      &lt;cfdi:Comprobante
</span></span><span style="display:flex;"><span>          xmlns:cfdi=<span style="color:#e6db74">&#34;http://www.sat.gob.mx/cfd/4&#34;</span>
</span></span><span style="display:flex;"><span>          xmlns:xsi=<span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>          xsi:schemaLocation=<span style="color:#e6db74">&#34;http://www.sat.gob.mx/cfd/4 cfdv40.xsd&#34;</span> 
</span></span><span style="display:flex;"><span>          Version=<span style="color:#e6db74">&#34;4.0&#34;</span>
</span></span><span style="display:flex;"><span>          Serie=<span style="color:#e6db74">&#34;F&#34;</span>
</span></span><span style="display:flex;"><span>          Folio=<span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span>          Fecha=<span style="color:#e6db74">&#34;2025-07-02T12:00:00&#34;</span>
</span></span><span style="display:flex;"><span>          SubTotal=<span style="color:#e6db74">&#34;100.00&#34;</span>
</span></span><span style="display:flex;"><span>          TipoCambio=<span style="color:#e6db74">&#34;1.0&#34;</span>
</span></span><span style="display:flex;"><span>          Serie=<span style="color:#e6db74">&#34;A&#34;</span>
</span></span><span style="display:flex;"><span>          Moneda=<span style="color:#e6db74">&#34;MXN&#34;</span>
</span></span><span style="display:flex;"><span>          Descuento=<span style="color:#e6db74">&#34;0.00&#34;</span>
</span></span><span style="display:flex;"><span>          Total=<span style="color:#e6db74">&#34;116.00&#34;</span>
</span></span><span style="display:flex;"><span>          TipoDeComprobante=<span style="color:#e6db74">&#34;I&#34;</span>
</span></span><span style="display:flex;"><span>          Exportacion=<span style="color:#e6db74">&#34;01&#34;</span>
</span></span><span style="display:flex;"><span>          MetodoPago=<span style="color:#e6db74">&#34;PUE&#34;</span>
</span></span><span style="display:flex;"><span>          CondicionesDePago=<span style="color:#e6db74">&#34;CONDICIONES&#34;</span>
</span></span><span style="display:flex;"><span>          FormaPago=<span style="color:#e6db74">&#34;01&#34;</span>
</span></span><span style="display:flex;"><span>          Confirmacion=<span style="color:#e6db74">&#34;A1234&#34;</span>
</span></span><span style="display:flex;"><span>          NoCertificado=<span style="color:#e6db74">&#34;30001000000300023708&#34;</span>
</span></span><span style="display:flex;"><span>          Certificado=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>          Sello=<span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>          LugarExpedicion=<span style="color:#e6db74">&#34;64000&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;cfdi:InformacionGlobal Meses=<span style="color:#e6db74">&#34;18&#34;</span> Año=<span style="color:#e6db74">&#34;2025&#34;</span> Periodicidad=<span style="color:#e6db74">&#34;05&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>          &lt;cfdi:CfdiRelacionados TipoRelacion=<span style="color:#e6db74">&#34;09&#34;</span>&gt;
</span></span><span style="display:flex;"><span>             &lt;cfdi:CfdiRelacionado UUID=<span style="color:#e6db74">&#34;ED1752FE-E865-4FF2-BFE1-0F552E770DC9&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>          &lt;/cfdi:CfdiRelacionados&gt;
</span></span><span style="display:flex;"><span>          &lt;cfdi:Emisor FacAtrAdquirente=<span style="color:#e6db74">&#34;0123456789&#34;</span> Rfc=<span style="color:#e6db74">&#34;ABC010101XYZ&#34;</span> Nombre=<span style="color:#e6db74">&#34;Empresa Ejemplo&#34;</span> RegimenFiscal=<span style="color:#e6db74">&#34;601&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>          &lt;cfdi:Receptor Rfc=<span style="color:#e6db74">&#34;XAXX010101000&#34;</span> Nombre=<span style="color:#e6db74">&#34;Publico en General&#34;</span> 
</span></span><span style="display:flex;"><span>                        DomicilioFiscalReceptor=<span style="color:#e6db74">&#34;64000&#34;</span> RegimenFiscalReceptor=<span style="color:#e6db74">&#34;616&#34;</span> 
</span></span><span style="display:flex;"><span>                        ResidenciaFiscal=<span style="color:#e6db74">&#34;MEX&#34;</span>
</span></span><span style="display:flex;"><span>                        UsoCFDI=<span style="color:#e6db74">&#34;G03&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>          &lt;cfdi:Conceptos&gt;
</span></span><span style="display:flex;"><span>              &lt;cfdi:Concepto ObjetoImp=<span style="color:#e6db74">&#34;01&#34;</span> ClaveProdServ=<span style="color:#e6db74">&#34;01010101&#34;</span> ClaveUnidad=<span style="color:#e6db74">&#34;C81&#34;</span> 
</span></span><span style="display:flex;"><span>                    NoIdentificacion=<span style="color:#e6db74">&#34;00001&#34;</span> Cantidad=<span style="color:#e6db74">&#34;1.5&#34;</span> 
</span></span><span style="display:flex;"><span>                      Unidad=<span style="color:#e6db74">&#34;TONELADA&#34;</span> Descripcion=<span style="color:#e6db74">&#34;ACERO&#34;</span> ValorUnitario=<span style="color:#e6db74">&#34;1500000&#34;</span> Importe=<span style="color:#e6db74">&#34;2250000&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;cfdi:Impuestos&gt;
</span></span><span style="display:flex;"><span>                      &lt;cfdi:Traslados&gt;
</span></span><span style="display:flex;"><span>                          &lt;cfdi:Traslado Base=<span style="color:#e6db74">&#34;100.00&#34;</span> Impuesto=<span style="color:#e6db74">&#34;002&#34;</span> TipoFactor=<span style="color:#e6db74">&#34;Tasa&#34;</span> 
</span></span><span style="display:flex;"><span>                                       TasaOCuota=<span style="color:#e6db74">&#34;0.160000&#34;</span> Importe=<span style="color:#e6db74">&#34;16.00&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                      &lt;/cfdi:Traslados&gt;
</span></span><span style="display:flex;"><span>                      &lt;cfdi:Retenciones&gt;
</span></span><span style="display:flex;"><span>                         &lt;cfdi:Retencion Base=<span style="color:#e6db74">&#34;2250000&#34;</span> Impuesto=<span style="color:#e6db74">&#34;001&#34;</span> TipoFactor=<span style="color:#e6db74">&#34;Tasa&#34;</span> TasaOCuota=<span style="color:#e6db74">&#34;0.300000&#34;</span> Importe=<span style="color:#e6db74">&#34;247500&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                      &lt;/cfdi:Retenciones&gt;
</span></span><span style="display:flex;"><span>                  &lt;/cfdi:Impuestos&gt;
</span></span><span style="display:flex;"><span>                  &lt;cfdi:CuentaPredial Numero=<span style="color:#e6db74">&#34;51888&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>              &lt;/cfdi:Concepto&gt;
</span></span><span style="display:flex;"><span>          &lt;/cfdi:Conceptos&gt;
</span></span><span style="display:flex;"><span>          &lt;cfdi:Impuestos TotalImpuestosRetenidos=<span style="color:#e6db74">&#34;247500&#34;</span>      
</span></span><span style="display:flex;"><span>                          TotalImpuestosTrasladados=<span style="color:#e6db74">&#34;360000&#34;</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;cfdi:Retenciones&gt;
</span></span><span style="display:flex;"><span>                &lt;cfdi:Retencion Impuesto=<span style="color:#e6db74">&#34;001&#34;</span> Importe=<span style="color:#e6db74">&#34;247000&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                &lt;cfdi:Retencion Impuesto=<span style="color:#e6db74">&#34;003&#34;</span> Importe=<span style="color:#e6db74">&#34;500&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>             &lt;/cfdi:Retenciones&gt;
</span></span><span style="display:flex;"><span>             &lt;cfdi:Traslados&gt;
</span></span><span style="display:flex;"><span>                   &lt;cfdi:Traslado Base=<span style="color:#e6db74">&#34;1.00&#34;</span> Impuesto=<span style="color:#e6db74">&#34;002&#34;</span> TipoFactor=<span style="color:#e6db74">&#34;Tasa&#34;</span> TasaOCuota=<span style="color:#e6db74">&#34;1.600000&#34;</span> Importe=<span style="color:#e6db74">&#34;360000&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>             &lt;/cfdi:Traslados&gt;
</span></span><span style="display:flex;"><span>          &lt;/cfdi:Impuestos&gt;
</span></span><span style="display:flex;"><span>          &lt;cfdi:Complemento&gt;&lt;/cfdi:Complemento&gt;
</span></span><span style="display:flex;"><span>      &lt;/cfdi:Comprobante&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;&#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// Invoca al servicio web para timbrar un CFDI de forma asíncrona.</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;param name=&#34;apiKey&#34;&gt;La credencial de acceso al servicio.&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;param name=&#34;xmlCfdi&#34;&gt;El contenido del CFDI a timbrar.&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;returns&gt;Un objeto RespuestaTimbrado con el resultado de la operación.&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;RespuestaTimbrado&gt; TimbrarAsync(<span style="color:#66d9ef">string</span> apiKey, <span style="color:#66d9ef">string</span> xmlCfdi)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">using</span> var client = <span style="color:#66d9ef">new</span> ServicioTimbradoWSPortTypeClient(<span style="color:#e6db74">&#34;ServicioTimbradoWSPort&#34;</span>);
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>      {            
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">var</span> response = <span style="color:#66d9ef">await</span> client.timbrarAsync(apiKey, xmlCfdi);
</span></span><span style="display:flex;"><span>                      
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> RespuestaTimbrado
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>              Code = response.code,
</span></span><span style="display:flex;"><span>              Message = response.message,
</span></span><span style="display:flex;"><span>              Data = response.data
</span></span><span style="display:flex;"><span>          };
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">catch</span> (FaultException&lt;RespuestaTimbrado&gt; ex)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>          _logger.LogError(ex, <span style="color:#e6db74">&#34;Error SOAP: {Code} - {Message}&#34;</span>, ex.Detail.code, ex.Detail.message);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">throw</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">catch</span> (CommunicationException ex)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>          _logger.LogError(ex, <span style="color:#e6db74">&#34;Error de comunicación con el servicio&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">throw</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">catch</span> (TimeoutException ex)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>          _logger.LogError(ex, <span style="color:#e6db74">&#34;Timeout en la comunicación&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">throw</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// Define la estructura del objeto de respuesta para mayor claridad.</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RespuestaTimbrado</span>
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string?</span> Code { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string?</span> Message { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string?</span> Data { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">// Ejemplo de uso de TimbrarAsync</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task EjemploUsoTimbrarAsync()
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">string</span> apiKey = <span style="color:#e6db74">&#34;TU_API_KEY_AQUI&#34;</span>;
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">string</span> xmlCfdi = TimbrarCfdi();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>     {
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">var</span> resultado = <span style="color:#66d9ef">await</span> TimbrarAsync(apiKey, xmlCfdi);
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> (resultado.Code == <span style="color:#e6db74">&#34;200&#34;</span>)
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span>             Console.WriteLine(<span style="color:#e6db74">&#34;¡Timbrado Exitoso!&#34;</span>);
</span></span><span style="display:flex;"><span>             Console.WriteLine(<span style="color:#e6db74">&#34;Mensaje: &#34;</span> + resultado.Message);
</span></span><span style="display:flex;"><span>             Console.WriteLine(<span style="color:#e6db74">&#34;--- XML Timbrado ---&#34;</span>);
</span></span><span style="display:flex;"><span>             Console.WriteLine(resultado.Data);
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>         {
</span></span><span style="display:flex;"><span>             Console.WriteLine(<span style="color:#e6db74">&#34;Error durante el timbrado:&#34;</span>);
</span></span><span style="display:flex;"><span>             Console.WriteLine(<span style="color:#e6db74">&#34;Código: &#34;</span> + resultado.Code);
</span></span><span style="display:flex;"><span>             Console.WriteLine(<span style="color:#e6db74">&#34;Mensaje: &#34;</span> + resultado.Message);
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">catch</span> (Exception ex)
</span></span><span style="display:flex;"><span>     {
</span></span><span style="display:flex;"><span>         Console.WriteLine(<span style="color:#e6db74">&#34;Ocurrió una excepción: &#34;</span> + ex.Message);
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span> }</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</div>


  <div
  class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
  id="tabs-panel-1"
  role="tabpanel"><h3>Herramienta wsimport<span class="hx-absolute -hx-mt-20" id="herramienta-wsimport"></span>
    <a href="#herramienta-wsimport" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>Java incluye la herramienta wsimport en el JDK para generar las clases cliente a partir de un WSDL.</p>
<p>Ejecuta el siguiente comando en tu terminal para el ambiente de DESARROLLO:</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>wsimport -keep -p com.facturaloplus.cliente https://dev.facturaloplus.com/ws/servicio.do?wsdl</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<p>-keep: Conserva los archivos fuente .java generados.</p>
<p>-p: Especifica el paquete (package) donde se guardarán las clases.</p>
<h3>Implementación<span class="hx-absolute -hx-mt-20" id="implementación"></span>
    <a href="#implementaci%c3%b3n" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// --- Archivo: RespuestaTimbrado.java ---</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> com.facturaloplus.cliente;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// POJO (Plain Old Java Object) para encapsular la respuesta.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RespuestaTimbrado</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String code;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String message;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String data;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Getters y Setters</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getCode</span>() { <span style="color:#66d9ef">return</span> code; }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCode</span>(String code) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> code; }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getMessage</span>() { <span style="color:#66d9ef">return</span> message; }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setMessage</span>(String message) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> message; }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getData</span>() { <span style="color:#66d9ef">return</span> data; }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setData</span>(String data) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> data; }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// --- Archivo: TimbradoService.java ---</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> com.facturaloplus.cliente;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.xml.ws.Service;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.xml.ws.WebServiceException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.xml.ws.soap.SOAPFaultException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.LocalDateTime;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.format.DateTimeFormatter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.CompletableFuture;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.ExecutorService;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.Executors;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.logging.Level;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.logging.Logger;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TimbradoService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger logger <span style="color:#f92672">=</span> Logger.<span style="color:#a6e22e">getLogger</span>(TimbradoService.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Se recomienda un ExecutorService para manejar los hilos de las tareas asíncronas.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ExecutorService executor <span style="color:#f92672">=</span> Executors.<span style="color:#a6e22e">newFixedThreadPool</span>(5);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">generarXmlCfdiEjemplo</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Usar la fecha y hora actual en formato UTC, requerido por el SAT.</span>
</span></span><span style="display:flex;"><span>      String fechaActual <span style="color:#f92672">=</span> LocalDateTime.<span style="color:#a6e22e">now</span>().<span style="color:#a6e22e">format</span>(DateTimeFormatter.<span style="color:#a6e22e">ofPattern</span>(<span style="color:#e6db74">&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Uso de Text Blocks (Java 15+) para el XML.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Nota: Se agregó ObjetoImp=&#34;02&#34; en el concepto, requerido en CFDI 4.0.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;cfdi:Comprobante
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xmlns:cfdi=&#34;http://www.sat.gob.mx/cfd/4&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xsi:schemaLocation=&#34;http://www.sat.gob.mx/cfd/4 cfdv40.xsd&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Version=&#34;4.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Serie=&#34;F&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Folio=&#34;123&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Fecha=&#34;%s&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          SubTotal=&#34;100.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          TipoCambio=&#34;1.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Serie=&#34;A&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Moneda=&#34;MXN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Descuento=&#34;0.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Total=&#34;116.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          TipoDeComprobante=&#34;I&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Exportacion=&#34;01&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          MetodoPago=&#34;PUE&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          CondicionesDePago=&#34;CONDICIONES&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          FormaPago=&#34;01&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Confirmacion=&#34;A1234&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          NoCertificado=&#34;30001000000300023708&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Certificado=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Sello=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          LugarExpedicion=&#34;64000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:InformacionGlobal Meses=&#34;18&#34; Año=&#34;2025&#34; Periodicidad=&#34;05&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:CfdiRelacionados TipoRelacion=&#34;09&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;cfdi:CfdiRelacionado UUID=&#34;ED1752FE-E865-4FF2-BFE1-0F552E770DC9&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:CfdiRelacionados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Emisor FacAtrAdquirente=&#34;0123456789&#34; Rfc=&#34;ABC010101XYZ&#34; Nombre=&#34;Empresa Ejemplo&#34; RegimenFiscal=&#34;601&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Receptor Rfc=&#34;XAXX010101000&#34; Nombre=&#34;Publico en General&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        DomicilioFiscalReceptor=&#34;64000&#34; RegimenFiscalReceptor=&#34;616&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        ResidenciaFiscal=&#34;MEX&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        UsoCFDI=&#34;G03&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Conceptos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;cfdi:Concepto ObjetoImp=&#34;01&#34; ClaveProdServ=&#34;01010101&#34; ClaveUnidad=&#34;C81&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    NoIdentificacion=&#34;00001&#34; Cantidad=&#34;1.5&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      Unidad=&#34;TONELADA&#34; Descripcion=&#34;ACERO&#34; ValorUnitario=&#34;1500000&#34; Importe=&#34;2250000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          &lt;cfdi:Traslado Base=&#34;100.00&#34; Impuesto=&#34;002&#34; TipoFactor=&#34;Tasa&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                       TasaOCuota=&#34;0.160000&#34; Importe=&#34;16.00&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;/cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                         &lt;cfdi:Retencion Base=&#34;2250000&#34; Impuesto=&#34;001&#34; TipoFactor=&#34;Tasa&#34; TasaOCuota=&#34;0.300000&#34; Importe=&#34;247500&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;/cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;/cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;cfdi:CuentaPredial Numero=&#34;51888&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;/cfdi:Concepto&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:Conceptos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Impuestos TotalImpuestosRetenidos=&#34;247500&#34;      
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          TotalImpuestosTrasladados=&#34;360000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;cfdi:Retencion Impuesto=&#34;001&#34; Importe=&#34;247000&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;cfdi:Retencion Impuesto=&#34;003&#34; Importe=&#34;500&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;/cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   &lt;cfdi:Traslado Base=&#34;1.00&#34; Impuesto=&#34;002&#34; TipoFactor=&#34;Tasa&#34; TasaOCuota=&#34;1.600000&#34; Importe=&#34;360000&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;/cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Complemento&gt;&lt;/cfdi:Complemento&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;/cfdi:Comprobante&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;&#34;&#34;</span>.<span style="color:#a6e22e">formatted</span>(fechaActual);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> CompletableFuture<span style="color:#f92672">&lt;</span>RespuestaTimbrado<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">timbrarAsync</span>(String apiKey, String xmlCfdi) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> CompletableFuture.<span style="color:#a6e22e">supplyAsync</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#75715e">// Las clases ServicioTimbradoWS y ServicioTimbradoWSPortType son generadas por wsimport.</span>
</span></span><span style="display:flex;"><span>              ServicioTimbradoWS service <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServicioTimbradoWS();
</span></span><span style="display:flex;"><span>              ServicioTimbradoWSPortType port <span style="color:#f92672">=</span> service.<span style="color:#a6e22e">getServicioTimbradoWSPort</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>              logger.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Iniciando timbrado para CFDI.&#34;</span>);
</span></span><span style="display:flex;"><span>              Respuesta response <span style="color:#f92672">=</span> port.<span style="color:#a6e22e">timbrar</span>(apiKey, xmlCfdi); <span style="color:#75715e">// &#39;Respuesta&#39; es la clase generada por wsimport.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>              RespuestaTimbrado resultado <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RespuestaTimbrado();
</span></span><span style="display:flex;"><span>              resultado.<span style="color:#a6e22e">setCode</span>(response.<span style="color:#a6e22e">getCode</span>());
</span></span><span style="display:flex;"><span>              resultado.<span style="color:#a6e22e">setMessage</span>(response.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>              resultado.<span style="color:#a6e22e">setData</span>(response.<span style="color:#a6e22e">getData</span>());
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">return</span> resultado;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">catch</span> (SOAPFaultException ex) {
</span></span><span style="display:flex;"><span>              logger.<span style="color:#a6e22e">log</span>(Level.<span style="color:#a6e22e">SEVERE</span>, <span style="color:#e6db74">&#34;Error SOAP (SOAPFaultException): &#34;</span> <span style="color:#f92672">+</span> ex.<span style="color:#a6e22e">getFault</span>().<span style="color:#a6e22e">getFaultString</span>(), ex);
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException(<span style="color:#e6db74">&#34;Error del servicio: &#34;</span> <span style="color:#f92672">+</span> ex.<span style="color:#a6e22e">getFault</span>().<span style="color:#a6e22e">getFaultString</span>(), ex);
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">catch</span> (WebServiceException ex) {
</span></span><span style="display:flex;"><span>              logger.<span style="color:#a6e22e">log</span>(Level.<span style="color:#a6e22e">SEVERE</span>, <span style="color:#e6db74">&#34;Error de comunicación con el servicio de timbrado.&#34;</span>, ex);
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException(<span style="color:#e6db74">&#34;Error de comunicación.&#34;</span>, ex);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      }, executor);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shutdown</span>() {
</span></span><span style="display:flex;"><span>      executor.<span style="color:#a6e22e">shutdown</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// --- Archivo: Main.java (Ejemplo de uso) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> com.facturaloplus.cliente;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.CompletableFuture;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Main</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>      TimbradoService timbradoService <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TimbradoService();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// El API Key debe obtenerse de una fuente segura, no estar en el código.</span>
</span></span><span style="display:flex;"><span>      String miApiKey <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;TU_API_KEY_AQUI&#34;</span>;
</span></span><span style="display:flex;"><span>      String xmlParaTimbrar <span style="color:#f92672">=</span> timbradoService.<span style="color:#a6e22e">generarXmlCfdiEjemplo</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;--- Intentando timbrar el siguiente CFDI: ---&#34;</span>);
</span></span><span style="display:flex;"><span>      System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(xmlParaTimbrar);
</span></span><span style="display:flex;"><span>      System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;------------------------------------------&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      CompletableFuture<span style="color:#f92672">&lt;</span>RespuestaTimbrado<span style="color:#f92672">&gt;</span> future <span style="color:#f92672">=</span> timbradoService.<span style="color:#a6e22e">timbrarAsync</span>(miApiKey, xmlParaTimbrar);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      future.<span style="color:#a6e22e">whenComplete</span>((resultado, ex) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (ex <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>              System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\nOcurrió una excepción no controlada: &#34;</span> <span style="color:#f92672">+</span> ex.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;200&#34;</span>.<span style="color:#a6e22e">equals</span>(resultado.<span style="color:#a6e22e">getCode</span>())) {
</span></span><span style="display:flex;"><span>                  System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n¡Timbrado Exitoso!&#34;</span>);
</span></span><span style="display:flex;"><span>                  System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Mensaje: &#34;</span> <span style="color:#f92672">+</span> resultado.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>                  System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n--- XML Timbrado ---&#34;</span>);
</span></span><span style="display:flex;"><span>                  System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(resultado.<span style="color:#a6e22e">getData</span>());
</span></span><span style="display:flex;"><span>              } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                  System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\nError durante el timbrado:&#34;</span>);
</span></span><span style="display:flex;"><span>                  System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Código: &#34;</span> <span style="color:#f92672">+</span> resultado.<span style="color:#a6e22e">getCode</span>());
</span></span><span style="display:flex;"><span>                  System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Mensaje: &#34;</span> <span style="color:#f92672">+</span> resultado.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Es importante cerrar el ExecutorService cuando la aplicación termina.</span>
</span></span><span style="display:flex;"><span>          timbradoService.<span style="color:#a6e22e">shutdown</span>();
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Mantiene el programa principal vivo mientras se completa la tarea asíncrona.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// En una aplicación real (ej. un servidor de aplicaciones), esto no sería necesario.</span>
</span></span><span style="display:flex;"><span>      future.<span style="color:#a6e22e">join</span>(); 
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</div>
  <div
  class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
  id="tabs-panel-2"
  role="tabpanel"><h3>Herramienta Zeep<span class="hx-absolute -hx-mt-20" id="herramienta-zeep"></span>
    <a href="#herramienta-zeep" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>Para interactuar con servicios SOAP en Python, la librería zeep es una excelente opción. Proporciona una interfaz limpia y moderna.</p>
<p>Instala la librería usando pip:</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><pre><code>pip install zeep</code></pre></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
<h3>Implementación<span class="hx-absolute -hx-mt-20" id="implementación"></span>
    <a href="#implementaci%c3%b3n" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>El siguiente código muestra una implementación robusta utilizando zeep y asyncio para realizar llamadas asíncronas al servicio web.</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># --- Archivo: timbrado_service.py ---</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> zeep <span style="color:#f92672">import</span> Client
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> zeep.asyncio <span style="color:#f92672">import</span> AsyncClient
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> zeep.exceptions <span style="color:#f92672">import</span> Fault, TransportError
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Configuración básica de logging</span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO, format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WSDL_URL_DESARROLLO <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://dev.facturaloplus.com/ws/servicio.do?wsdl&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RespuestaTimbrado</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;Clase de datos para encapsular la respuesta del servicio.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  code: str <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>  message: str <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>  data: str <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TimbradoService</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;Clase que encapsula la lógica para interactuar con el servicio de timbrado.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, wsdl_url: str):
</span></span><span style="display:flex;"><span>      self<span style="color:#f92672">.</span>wsdl_url <span style="color:#f92672">=</span> wsdl_url
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># El cliente asíncrono se crea al momento de usarlo</span>
</span></span><span style="display:flex;"><span>      self<span style="color:#f92672">.</span>async_client <span style="color:#f92672">=</span> AsyncClient(self<span style="color:#f92672">.</span>wsdl_url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generar_xml_cfdi_ejemplo</span>(self) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      Genera un XML de ejemplo para un CFDI 4.0.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      En una aplicación real, este XML se construiría dinámicamente.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Usar la fecha y hora actual en formato UTC, requerido por el SAT.</span>
</span></span><span style="display:flex;"><span>      fecha_actual <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">T%H:%M:%S&#39;</span>)
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Uso de f-strings para formatear el XML.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Nota: Se agregó ObjetoImp=&#34;02&#34; en el concepto, requerido en CFDI 4.0.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;cfdi:Comprobante
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xmlns:cfdi=&#34;http://www.sat.gob.mx/cfd/4&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xsi:schemaLocation=&#34;http://www.sat.gob.mx/cfd/4 cfdv40.xsd&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Version=&#34;4.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Serie=&#34;F&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Folio=&#34;123&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Fecha=&#34;</span><span style="color:#e6db74">{</span>fecha_actual<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          SubTotal=&#34;100.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          TipoCambio=&#34;1.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Serie=&#34;A&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Moneda=&#34;MXN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Descuento=&#34;0.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Total=&#34;116.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          TipoDeComprobante=&#34;I&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Exportacion=&#34;01&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          MetodoPago=&#34;PUE&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          CondicionesDePago=&#34;CONDICIONES&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          FormaPago=&#34;01&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Confirmacion=&#34;A1234&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          NoCertificado=&#34;30001000000300023708&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Certificado=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Sello=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          LugarExpedicion=&#34;64000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:InformacionGlobal Meses=&#34;18&#34; Año=&#34;2025&#34; Periodicidad=&#34;05&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:CfdiRelacionados TipoRelacion=&#34;09&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;cfdi:CfdiRelacionado UUID=&#34;ED1752FE-E865-4FF2-BFE1-0F552E770DC9&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:CfdiRelacionados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Emisor FacAtrAdquirente=&#34;0123456789&#34; Rfc=&#34;ABC010101XYZ&#34; Nombre=&#34;Empresa Ejemplo&#34; RegimenFiscal=&#34;601&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Receptor Rfc=&#34;XAXX010101000&#34; Nombre=&#34;Publico en General&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        DomicilioFiscalReceptor=&#34;64000&#34; RegimenFiscalReceptor=&#34;616&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        ResidenciaFiscal=&#34;MEX&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        UsoCFDI=&#34;G03&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Conceptos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;cfdi:Concepto ObjetoImp=&#34;01&#34; ClaveProdServ=&#34;01010101&#34; ClaveUnidad=&#34;C81&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    NoIdentificacion=&#34;00001&#34; Cantidad=&#34;1.5&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      Unidad=&#34;TONELADA&#34; Descripcion=&#34;ACERO&#34; ValorUnitario=&#34;1500000&#34; Importe=&#34;2250000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          &lt;cfdi:Traslado Base=&#34;100.00&#34; Impuesto=&#34;002&#34; TipoFactor=&#34;Tasa&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                       TasaOCuota=&#34;0.160000&#34; Importe=&#34;16.00&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;/cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                         &lt;cfdi:Retencion Base=&#34;2250000&#34; Impuesto=&#34;001&#34; TipoFactor=&#34;Tasa&#34; TasaOCuota=&#34;0.300000&#34; Importe=&#34;247500&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;/cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;/cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;cfdi:CuentaPredial Numero=&#34;51888&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;/cfdi:Concepto&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:Conceptos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Impuestos TotalImpuestosRetenidos=&#34;247500&#34;      
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          TotalImpuestosTrasladados=&#34;360000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;cfdi:Retencion Impuesto=&#34;001&#34; Importe=&#34;247000&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;cfdi:Retencion Impuesto=&#34;003&#34; Importe=&#34;500&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;/cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   &lt;cfdi:Traslado Base=&#34;1.00&#34; Impuesto=&#34;002&#34; TipoFactor=&#34;Tasa&#34; TasaOCuota=&#34;1.600000&#34; Importe=&#34;360000&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;/cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Complemento&gt;&lt;/cfdi:Complemento&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;/cfdi:Comprobante&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">timbrar_async</span>(self, api_key: str, xml_cfdi: str) <span style="color:#f92672">-&gt;</span> RespuestaTimbrado:
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;&#34;&#34;Invoca al servicio web para timbrar un CFDI de forma asíncrona.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>          logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Iniciando timbrado para CFDI.&#34;</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># El nombre del servicio &#39;ServicioTimbradoWSPort&#39; y la operación &#39;timbrar&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># son definidos por el WSDL.</span>
</span></span><span style="display:flex;"><span>          response <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>async_client<span style="color:#f92672">.</span>service<span style="color:#f92672">.</span>timbrar(apikey<span style="color:#f92672">=</span>api_key, xmlCFDI<span style="color:#f92672">=</span>xml_cfdi)
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># Zeep convierte la respuesta en un objeto similar a un diccionario.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> RespuestaTimbrado(
</span></span><span style="display:flex;"><span>              code<span style="color:#f92672">=</span>response<span style="color:#f92672">.</span>code,
</span></span><span style="display:flex;"><span>              message<span style="color:#f92672">=</span>response<span style="color:#f92672">.</span>message,
</span></span><span style="display:flex;"><span>              data<span style="color:#f92672">=</span>response<span style="color:#f92672">.</span>data
</span></span><span style="display:flex;"><span>          )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">except</span> Fault <span style="color:#66d9ef">as</span> ex:
</span></span><span style="display:flex;"><span>          logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error SOAP (Fault): Code=</span><span style="color:#e6db74">{</span>ex<span style="color:#f92672">.</span>code<span style="color:#e6db74">}</span><span style="color:#e6db74">, Message=</span><span style="color:#e6db74">{</span>ex<span style="color:#f92672">.</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ConnectionError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error del servicio: </span><span style="color:#e6db74">{</span>ex<span style="color:#f92672">.</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">from</span> ex
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">except</span> TransportError <span style="color:#66d9ef">as</span> ex:
</span></span><span style="display:flex;"><span>          logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error de comunicación con el servicio de timbrado: </span><span style="color:#e6db74">{</span>ex<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">raise</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- Archivo: main.py (Ejemplo de uso) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;Función principal para ejecutar el ejemplo.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  service <span style="color:#f92672">=</span> TimbradoService(WSDL_URL_DESARROLLO)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># El API Key debe obtenerse de una fuente segura, no estar en el código.</span>
</span></span><span style="display:flex;"><span>  mi_api_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;TU_API_KEY_AQUI&#34;</span>
</span></span><span style="display:flex;"><span>  xml_para_timbrar <span style="color:#f92672">=</span> service<span style="color:#f92672">.</span>generar_xml_cfdi_ejemplo()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">&#34;--- Intentando timbrar el siguiente CFDI: ---&#34;</span>)
</span></span><span style="display:flex;"><span>  print(xml_para_timbrar)
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">&#34;------------------------------------------&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>      resultado <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> service<span style="color:#f92672">.</span>timbrar_async(mi_api_key, xml_para_timbrar)
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> resultado<span style="color:#f92672">.</span>code <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;200&#34;</span>:
</span></span><span style="display:flex;"><span>          print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\033</span><span style="color:#e6db74">[92m</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">¡Timbrado Exitoso!</span><span style="color:#ae81ff">\033</span><span style="color:#e6db74">[0m&#34;</span>) <span style="color:#75715e"># Color verde</span>
</span></span><span style="display:flex;"><span>          print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Mensaje: </span><span style="color:#e6db74">{</span>resultado<span style="color:#f92672">.</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>          print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">--- XML Timbrado ---&#34;</span>)
</span></span><span style="display:flex;"><span>          print(resultado<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>          print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\033</span><span style="color:#e6db74">[91m</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Error durante el timbrado:</span><span style="color:#ae81ff">\033</span><span style="color:#e6db74">[0m&#34;</span>) <span style="color:#75715e"># Color rojo</span>
</span></span><span style="display:flex;"><span>          print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Código: </span><span style="color:#e6db74">{</span>resultado<span style="color:#f92672">.</span>code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>          print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Mensaje: </span><span style="color:#e6db74">{</span>resultado<span style="color:#f92672">.</span>message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> ex:
</span></span><span style="display:flex;"><span>      print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\033</span><span style="color:#e6db74">[91m</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Ocurrió una excepción no controlada: </span><span style="color:#e6db74">{</span>ex<span style="color:#e6db74">}</span><span style="color:#ae81ff">\033</span><span style="color:#e6db74">[0m&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>  asyncio<span style="color:#f92672">.</span>run(main())</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</div>
  <div
  class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
  id="tabs-panel-3"
  role="tabpanel"><h3>Herramienta SoapClient<span class="hx-absolute -hx-mt-20" id="herramienta-soapclient"></span>
    <a href="#herramienta-soapclient" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>PHP tiene soporte nativo para SOAP a través de la extensión SOAP. Asegúrate de que la extensión php-soap esté habilitada en tu archivo php.ini.</p>
<h3>Implementación<span class="hx-absolute -hx-mt-20" id="implementación"></span>
    <a href="#implementaci%c3%b3n" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>El siguiente código muestra una implementación orientada a objetos para consumir el servicio de timbrado.</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">

<div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// --- Archivo: Timbrado.php ---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Habilitar la visualización de errores para depuración
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">ini_set</span>(<span style="color:#e6db74">&#39;display_errors&#39;</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">error_reporting</span>(<span style="color:#66d9ef">E_ALL</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * Clase DTO (Data Transfer Object) para encapsular la respuesta del servicio.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RespuestaTimbrado</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">string</span> $code <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">string</span> $message <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#f92672">?</span><span style="color:#a6e22e">string</span> $data <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * Clase que encapsula la lógica para interactuar con el servicio de timbrado.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TimbradoService</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">string</span> $wsdlUrl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">__construct</span>(<span style="color:#a6e22e">string</span> $wsdlUrl) {
</span></span><span style="display:flex;"><span>      $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">wsdlUrl</span> <span style="color:#f92672">=</span> $wsdlUrl;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">/**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   * Genera un XML de ejemplo para un CFDI 4.0.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generarXmlCfdiEjemplo</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">string</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Usar la fecha y hora actual en formato UTC, requerido por el SAT.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      $fechaActual <span style="color:#f92672">=</span> <span style="color:#a6e22e">gmdate</span>(<span style="color:#e6db74">&#39;Y-m-d\TH:i:s&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Nota: Se agregó ObjetoImp=&#34;02&#34; en el concepto, requerido en CFDI 4.0.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&lt;&lt;&lt;</span><span style="color:#e6db74">XML</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;cfdi:Comprobante
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xmlns:cfdi=&#34;http://www.sat.gob.mx/cfd/4&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xsi:schemaLocation=&#34;http://www.sat.gob.mx/cfd/4 cfdv40.xsd&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Version=&#34;4.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Serie=&#34;F&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Folio=&#34;123&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Fecha=&#34;{$fechaActual}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          SubTotal=&#34;100.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          TipoCambio=&#34;1.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Serie=&#34;A&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Moneda=&#34;MXN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Descuento=&#34;0.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Total=&#34;116.00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          TipoDeComprobante=&#34;I&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Exportacion=&#34;01&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          MetodoPago=&#34;PUE&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          CondicionesDePago=&#34;CONDICIONES&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          FormaPago=&#34;01&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Confirmacion=&#34;A1234&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          NoCertificado=&#34;30001000000300023708&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Certificado=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Sello=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          LugarExpedicion=&#34;64000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:InformacionGlobal Meses=&#34;18&#34; Año=&#34;2025&#34; Periodicidad=&#34;05&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:CfdiRelacionados TipoRelacion=&#34;09&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;cfdi:CfdiRelacionado UUID=&#34;ED1752FE-E865-4FF2-BFE1-0F552E770DC9&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:CfdiRelacionados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Emisor FacAtrAdquirente=&#34;0123456789&#34; Rfc=&#34;ABC010101XYZ&#34; Nombre=&#34;Empresa Ejemplo&#34; RegimenFiscal=&#34;601&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Receptor Rfc=&#34;XAXX010101000&#34; Nombre=&#34;Publico en General&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        DomicilioFiscalReceptor=&#34;64000&#34; RegimenFiscalReceptor=&#34;616&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        ResidenciaFiscal=&#34;MEX&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        UsoCFDI=&#34;G03&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Conceptos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;cfdi:Concepto ObjetoImp=&#34;01&#34; ClaveProdServ=&#34;01010101&#34; ClaveUnidad=&#34;C81&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    NoIdentificacion=&#34;00001&#34; Cantidad=&#34;1.5&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      Unidad=&#34;TONELADA&#34; Descripcion=&#34;ACERO&#34; ValorUnitario=&#34;1500000&#34; Importe=&#34;2250000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          &lt;cfdi:Traslado Base=&#34;100.00&#34; Impuesto=&#34;002&#34; TipoFactor=&#34;Tasa&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                       TasaOCuota=&#34;0.160000&#34; Importe=&#34;16.00&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;/cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                         &lt;cfdi:Retencion Base=&#34;2250000&#34; Impuesto=&#34;001&#34; TipoFactor=&#34;Tasa&#34; TasaOCuota=&#34;0.300000&#34; Importe=&#34;247500&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      &lt;/cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;/cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &lt;cfdi:CuentaPredial Numero=&#34;51888&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;/cfdi:Concepto&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:Conceptos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Impuestos TotalImpuestosRetenidos=&#34;247500&#34;      
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          TotalImpuestosTrasladados=&#34;360000&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &lt;cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;cfdi:Retencion Impuesto=&#34;001&#34; Importe=&#34;247000&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;cfdi:Retencion Impuesto=&#34;003&#34; Importe=&#34;500&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;/cfdi:Retenciones&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   &lt;cfdi:Traslado Base=&#34;1.00&#34; Impuesto=&#34;002&#34; TipoFactor=&#34;Tasa&#34; TasaOCuota=&#34;1.600000&#34; Importe=&#34;360000&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             &lt;/cfdi:Traslados&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;/cfdi:Impuestos&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt;cfdi:Complemento&gt;&lt;/cfdi:Complemento&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt;/cfdi:Comprobante&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#e6db74">XML</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">/**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   * Invoca al servicio web para timbrar un CFDI.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">timbrar</span>(<span style="color:#a6e22e">string</span> $apiKey, <span style="color:#a6e22e">string</span> $xmlCfdi)<span style="color:#f92672">:</span> <span style="color:#a6e22e">RespuestaTimbrado</span> {
</span></span><span style="display:flex;"><span>      $respuesta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RespuestaTimbrado</span>();
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Opciones para el cliente SOAP. &#39;trace&#39; es útil para depurar.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          $options <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;trace&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;exceptions&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>, <span style="color:#75715e">// Lanza SoapFault en caso de error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#e6db74">&#39;cache_wsdl&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">WSDL_CACHE_NONE</span>
</span></span><span style="display:flex;"><span>          ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Crear el cliente SOAP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          $soapClient <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SoapClient</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">wsdlUrl</span>, $options);
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Los parámetros deben estar en un array asociativo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          $params <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;apikey&#39;</span>  <span style="color:#f92672">=&gt;</span> $apiKey,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;xmlCFDI&#39;</span> <span style="color:#f92672">=&gt;</span> $xmlCfdi
</span></span><span style="display:flex;"><span>          ];
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Llamar a la operación &#39;timbrar&#39; del servicio
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          $response <span style="color:#f92672">=</span> $soapClient<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">timbrar</span>($params);
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          $respuesta<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> $response<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">return</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">code</span> <span style="color:#f92672">??</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>          $respuesta<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> $response<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">return</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span> <span style="color:#f92672">??</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>          $respuesta<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> $response<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">return</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">data</span> <span style="color:#f92672">??</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">SoapFault</span> $e) {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Capturar errores específicos de SOAP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">error_log</span>(<span style="color:#e6db74">&#34;Error SOAP (SoapFault): &#34;</span> <span style="color:#f92672">.</span> $e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>          $respuesta<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;FAULT&#34;</span>;
</span></span><span style="display:flex;"><span>          $respuesta<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Error en la comunicación SOAP: &#34;</span> <span style="color:#f92672">.</span> $e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getMessage</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">Exception</span> $e) {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Capturar otros errores
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">error_log</span>(<span style="color:#e6db74">&#34;Error general: &#34;</span> <span style="color:#f92672">.</span> $e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>          $respuesta<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;EXCEPTION&#34;</span>;
</span></span><span style="display:flex;"><span>          $respuesta<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ocurrió una excepción: &#34;</span> <span style="color:#f92672">.</span> $e<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getMessage</span>();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> $respuesta;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// --- Archivo: index.php (Ejemplo de uso) ---
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Incluir la clase del servicio
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// require_once &#39;Timbrado.php&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>$wsdlDesarrollo <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://dev.facturaloplus.com/ws/servicio.do?wsdl&#34;</span>;
</span></span><span style="display:flex;"><span>$timbradoService <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TimbradoService</span>($wsdlDesarrollo);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// El API Key debe obtenerse de una fuente segura, como una variable de entorno.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$miApiKey <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#39;TIMBRADO_API_KEY&#39;</span>) <span style="color:#f92672">?:</span> <span style="color:#e6db74">&#34;TU_API_KEY_AQUI&#34;</span>;
</span></span><span style="display:flex;"><span>$xmlParaTimbrar <span style="color:#f92672">=</span> $timbradoService<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">generarXmlCfdiEjemplo</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Imprimir en formato de texto plano para una mejor visualización en consola o web
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;Content-Type: text/plain; charset=utf-8&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;--- Intentando timbrar el siguiente CFDI: ---</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $xmlParaTimbrar;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">------------------------------------------</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$resultado <span style="color:#f92672">=</span> $timbradoService<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">timbrar</span>($miApiKey, $xmlParaTimbrar);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($resultado<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;200&#39;</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;¡Timbrado Exitoso!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Mensaje: </span><span style="color:#e6db74">{</span>$resultado<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">--- XML Timbrado ---</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> $resultado<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Error durante el timbrado:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Código: </span><span style="color:#e6db74">{</span>$resultado<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">code</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Mensaje: </span><span style="color:#e6db74">{</span>$resultado<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>
</div>
</div>

</div>
<h4>Respuesta (Response)<span class="hx-absolute -hx-mt-20" id="respuesta-response"></span>
    <a href="#respuesta-response" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
        </div>
        <div class="hx-mt-16"></div>
        <div class="hx-mb-8 hx-flex hx-items-center hx-border-t hx-pt-8 dark:hx-border-neutral-800 contrast-more:hx-border-neutral-400 dark:contrast-more:hx-border-neutral-400 print:hx-hidden"><a
        href="/facturotas.docs/api/schemas/"
        title="Schemas"
        class="hx-flex hx-max-w-[50%] hx-items-center hx-gap-1 hx-py-4 hx-text-base hx-font-medium hx-text-gray-600 hx-transition-colors [word-break:break-word] hover:hx-text-primary-600 dark:hx-text-gray-300 md:hx-text-lg ltr:hx-ml-auto ltr:hx-pl-4 ltr:hx-text-right rtl:hx-mr-auto rtl:hx-pr-4 rtl:hx-text-left"
      >Schemas<svg class="hx-inline hx-h-5 hx-shrink-0 rtl:-hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></a></div>
        
      </main>
    </article>
  </div>

      <footer class="hextra-footer hx-bg-gray-100 hx-pb-[env(safe-area-inset-bottom)] dark:hx-bg-neutral-900 print:hx-bg-transparent"><div
      class="hextra-custom-footer hx-max-w-screen-xl hx-pl-[max(env(safe-area-inset-left),1.5rem)] hx-pr-[max(env(safe-area-inset-right),1.5rem)] hx-text-gray-600 dark:hx-text-gray-400"
    ></div><div
        class="hx-max-w-screen-xl hx-mx-auto hx-flex hx-justify-center hx-py-12 hx-pl-[max(env(safe-area-inset-left),1.5rem)] hx-pr-[max(env(safe-area-inset-right),1.5rem)] hx-text-gray-600 dark:hx-text-gray-400 md:hx-justify-start"
      >
        <div class="hx-flex hx-w-full hx-flex-col hx-items-center sm:hx-items-start"><div class="hx-font-semibold"><a class="hx-flex hx-text-sm hx-items-center hx-gap-1 hx-text-current" target="_blank" rel="noopener noreferrer" title="Hextra GitHub Homepage" href="https://github.com/imfing/hextra">
    <span>Powered by Hextra<svg height=1em class="hx-inline-block ltr:hx-ml-1 rtl:hx-mr-1 hx-align-[-2.5px]" viewBox="0 0 180 180" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="m 105.50024,22.224647 c -9.59169,-5.537563 -21.40871,-5.537563 -31.000093,0 L 39.054693,42.689119 C 29.463353,48.226675 23.55484,58.460531 23.55484,69.535642 v 40.928918 c 0,11.07542 5.908513,21.3092 15.499853,26.84652 l 35.445453,20.46446 c 9.591313,5.53732 21.408404,5.53732 31.000094,0 l 35.44507,-20.46446 c 9.59131,-5.53732 15.49985,-15.7711 15.49985,-26.84652 V 69.535642 c 0,-11.075111 -5.90854,-21.308967 -15.49985,-26.846523 z M 34.112797,85.737639 c -1.384445,2.397827 -1.384445,5.352099 0,7.749927 l 24.781554,42.922974 c 1.38437,2.39783 3.942853,3.87496 6.711592,3.87496 h 49.563107 c 2.76905,0 5.3273,-1.47713 6.71144,-3.87496 l 24.78194,-42.922974 c 1.38414,-2.397828 1.38414,-5.3521 0,-7.749927 L 121.88049,42.814746 c -1.38414,-2.397828 -3.94239,-3.874964 -6.71144,-3.874964 H 65.605944 c -2.768739,0 -5.327223,1.477059 -6.711592,3.874964 z" style="stroke-width:0.774993" /></svg></span>
  </a></div></div>
      </div></footer>
    
    <script defer src="/facturotas.docs/js/main.js" integrity=""></script>
<script defer src="/facturotas.docs/lib/flexsearch/flexsearch.bundle.min.0425860527cc9968f9f049421c7a56b39327d475e2e3a8f550416be3a9134327.js" integrity="sha256-BCWGBSfMmWj58ElCHHpWs5Mn1HXi46j1UEFr46kTQyc="></script>
    <script defer src="/facturotas.docs/en.search.js" integrity=""></script>
  </body>
</html>
